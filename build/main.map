{"version":3,"sources":["webpack:///webpack/bootstrap ff9badca7560e896c749","webpack:///external \"mongoose\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/config/index.js","webpack:///external \"koa-router\"","webpack:///external \"path\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"md5\"","webpack:///./nuxt.config.js","webpack:///./server/routes/index.js","webpack:///external \"@koa/cors\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-static\"","webpack:///external \"nuxt\"","webpack:///./server/controllers/article.js","webpack:///./server/controllers/tag.js","webpack:///./server/controllers/user.js","webpack:///./server/middlewares/check-token.js","webpack:///./server/models/article.js","webpack:///./server/models/index.js","webpack:///./server/models/tag.js","webpack:///./server/models/user.js","webpack:///external \"formidable\"","webpack:///external \"fs\"","webpack:///external \"os\"","webpack:///external \"postcss-cssnext\"","webpack:///external \"postcss-import\"","webpack:///external \"postcss-url\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["user","role","username","password","email","nickname","motto","avatar","jwt","secret","mongodb","host","database","port","production","domain","app","routerBaseApi","module","exports","head","title","meta","charset","name","content","hid","link","rel","type","href","css","loading","color","babel","plugins","libraryName","styleLibraryName","build","vendor","postcss","require","manifest","description","theme_color","modules","router","prefix","config","tag","article","get","getUserInfo","patch","patchUserInfo","post","login","logout","getTagsOrArticles","postTag","patchTag","del","deleteTag","search","getArticle","getArticles","getPrivateArticles","archives","postArticle","upload","patchArticle","deleteArticle","Article","mongoose","model","ctx","next","params","page","limit","Number","find","publish","exec","total","length","populate","path","select","skip","sort","data","body","success","err","id","findOne","_id","findByIdAndUpdate","views","request","String","save","updatedAt","Date","now","findByIdAndRemove","keyword","reg","RegExp","$or","$regex","articles","arr","arr2","year","month","date","i","createdAt","getFullYear","getMonth","push","archiveArticles","j","getImgUrl","Promise","resolve","reject","form","parse","req","fields","files","console","log","lastItem","Object","keys","extname","oldUrl","newUrl","readStream","fs","createReadStream","writeStream","createWriteStream","pipe","imgUrl","protocol","formidable","IncomingForm","then","url","Tag","tags","User","md5","expiresIn","token","sign","userID","cookies","set","avatarUrl","oldPassword","newPassword","findOneAndUpdate","decoded","verify","Schema","ArticleSchema","Boolean","default","flag","like","Array","comments","Types","ObjectId","ref","options","toJSON","virtuals","versionKey","transform","doc","ret","mongoUrl","global","connection","openUri","once","userInfo","on","error","warn","TagSchema","UserSchema","process","env","HOST","globalConfig","PORT","use","cors","bodyParser","KoaStatic","route","routes","allowedMethods","dev","nuxt","builder","status","res","render","promise","catch","listen","start"],"mappings":";;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,qC;;;;;;ACAA;;;;;;;;ACAA,4CAAe;AACbA,QAAM;AACJC,UAAM,YADF;AAEJC,cAAU,GAFN;AAGJC,cAAU,GAHN;AAIJC,WAAO,sBAJH;AAKJC,cAAU,SALN;AAMJC,WAAO,wBANH;AAOJC,YAAQ;AAPJ,GADO;AAUbC,OAAK;AACHC,YAAQ;AADL,GAVQ;AAabC,WAAS;AACPC,UAAM,WADC;AAEPC,cAAU,SAFH;AAGPC,UAAM,KAHC;AAIPX,cAAU,EAJH;AAKPC,cAAU;AALH,GAbI;AAoBbW,cAAY;AACVH,UAAM,eADI;AAEVI,YAAQ;AACR;AAHU,GApBC;AAyBbC,OAAK;AACHL,UAAM,WADH;AAEHE,UAAM,IAFH;AAGHI,mBAAe;AAHZ;AAzBQ,CAAf,C;;;;;;ACAA,uC;;;;;;ACAA,iC;;;;;;ACAA,yC;;;;;;ACAA,gC;;;;;;ACAAC,OAAOC,OAAP,GAAiB;AACfC,QAAM;AACJC,WAAO,SADH;AAEJC,UAAM,CACJ,EAAEC,SAAS,OAAX,EADI,EAEJ,EAAEC,MAAM,UAAR,EAAoBC,SAAS,qCAA7B,EAFI,EAGJ,EAAEC,KAAK,aAAP,EAAsBF,MAAM,aAA5B,EAA2CC,SAAS,YAApD,EAHI,CAFF;AAOJE,UAAM,CACJ,EAAEC,KAAK,MAAP,EAAeC,MAAM,cAArB,EAAqCC,MAAM,cAA3C,EADI;AAPF,GADS;AAYfC,OAAK,CAAC,sBAAD,EAAyB,gCAAzB,EAA0D,sCAA1D,CAZU;AAafC,WAAS,EAAEC,OAAO,SAAT,EAbM;AAcfC,SAAO;AACLC,aAAS,CAAC,CAAC,WAAD,EAAc,CAAC;AACvBC,mBAAa,YADU;AAEvBC,wBAAkB;AAFK,KAAD,CAAd,CAAD;AADJ,GAdQ;AAoBfC,SAAO;AACLC,YAAQ,CAAC,OAAD,EAAS,YAAT,CADH;AAELC,aAAS,CACP,mBAAAC,CAAQ,EAAR,GADO,EAEP,mBAAAA,CAAQ,EAAR,GAFO,EAGP,mBAAAA,CAAQ,EAAR,GAHO;AAKT;;;;;;;;;;AAPK,GApBQ;AAsCfC,YAAU;AACRlB,UAAM,SADE;AAERmB,iBAAa,eAFL;AAGRC,iBAAa;AAHL,GAtCK;AA2CfC,WAAS,CAAC,aAAD,CA3CM;AA4CfV,WAAS,CAAC,yBAAD,EAA4B,sBAA5B,EAAmD,sBAAnD;AA5CM,CAAjB,C;;;;;;;;;;;;ACAA;AACA;AACA;AACA;;AAEA,IAAMW,SAAS,IAAI,kDAAJ,CAAW;AACxBC,UAAQ,wDAAAC,CAAOhC,GAAP,CAAWC;AADK,CAAX,CAAf;;AAIA,IAAMjB,OAAO,mBAAAyC,CAAQ,EAAR,CAAb;AACA,IAAMQ,MAAM,mBAAAR,CAAQ,EAAR,CAAZ;AACA,IAAMS,UAAU,mBAAAT,CAAQ,EAAR,CAAhB;;AAEAK,OACGK,GADH,CACO,OADP,EACgBnD,KAAKoD,WADrB,EAEGC,KAFH,CAES,OAFT,EAEkBrD,KAAKsD,aAFvB,EAGGC,IAHH,CAGQ,QAHR,EAGkBvD,KAAKwD,KAHvB,EAIGD,IAJH,CAIQ,SAJR,EAImBvD,KAAKyD,MAJxB;;AAMAX,OACGK,GADH,CACO,YADP,EACqBF,IAAIS,iBADzB,EAEGH,IAFH,CAEQ,MAFR,EAEgB,yEAFhB,EAE4BN,IAAIU,OAFhC,EAGGN,KAHH,CAGS,MAHT,EAGiB,yEAHjB,EAG6BJ,IAAIW,QAHjC,EAIGC,GAJH,CAIO,WAJP,EAIoB,yEAJpB,EAIgCZ,IAAIa,SAJpC;;AAMAhB,OACGK,GADH,CACO,mBADP,EAC4BD,QAAQa,MADpC,EAEGZ,GAFH,CAEO,eAFP,EAEwBD,QAAQc,UAFhC,EAGGb,GAHH,CAGO,0BAHP,EAGmCD,QAAQe,WAH3C,EAIGd,GAJH,CAIO,mBAJP,EAI4B,yEAJ5B,EAIwCD,QAAQgB,kBAJhD,EAKGf,GALH,CAKO,WALP,EAKoBD,QAAQiB,QAL5B,EAMGZ,IANH,CAMQ,UANR,EAMoB,yEANpB,EAMgCL,QAAQkB,WANxC,EAOGb,IAPH,CAOQ,SAPR,EAOmB,yEAPnB,EAO+BL,QAAQmB,MAPvC,EAQGhB,KARH,CAQS,UART,EAQqB,yEARrB,EAQiCH,QAAQoB,YARzC,EASGT,GATH,CASO,eATP,EASwB,yEATxB,EASoCX,QAAQqB,aAT5C;;AAWA,4CAAezB,MAAf,C;;;;;;ACpCA,sC;;;;;;ACAA,gC;;;;;;ACAA,2C;;;;;;ACAA,uC;;;;;;ACAA,iC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA,IAAM0B,UAAU,gDAAAC,CAASC,KAAT,CAAe,SAAf,CAAhB;;AAEO,IAAMT;AAAA,6JAAc,iBAAMU,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,0BACMD,IAAIE,MADV,iCACnBC,IADmB,EACnBA,IADmB,oCACZ,CADY,qDACTC,KADS,EACTA,KADS,qCACD,EADC;;AAEzBD,mBAAOE,OAAO,CAACF,OAAO,CAAR,IAAaC,KAApB,KAA8B,CAArC;AACAA,oBAAQC,OAAOD,KAAP,KAAiB,EAAzB;;AAHyB;AAAA;AAAA,mBAMLP,QAAQS,IAAR,CAAa,EAAEC,SAAS,IAAX,EAAb,EAAgCC,IAAhC,EANK;;AAAA;AAMnBC,iBANmB;;AAOvBA,oBAAQA,MAAMC,MAAd;AAPuB;AAAA,mBAQJb,QAAQS,IAAR,CAAa,EAAEC,SAAS,IAAX,EAAb,EAChBI,QADgB,CACP;AACRC,oBAAM,MADE;AAERC,sBAAQ;AAFA,aADO,EAKhBC,IALgB,CAKXX,IALW,EAMhBC,KANgB,CAMVA,KANU,EAOhBW,IAPgB,CAOX,EAAC,aAAa,CAAC,CAAf,EAPW,EAQhBP,IARgB,EARI;;AAAA;AAQjBQ,gBARiB;;AAiBvBhB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMA,IAFG;AAGTP,qBAAOA;AAHE,aAAX;AAjBuB;AAAA;;AAAA;AAAA;AAAA;;AAuBvBT,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC,8BAFS;AAGTV,qBAAO;AAHE,aAAX;;AAvBuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAd;;AAAA;AAAA;AAAA;AAAA,GAAN;;AA+BA,IAAMlB;AAAA,8JAAqB,kBAAMS,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACbJ,QAAQS,IAAR,CAAa,EAAEC,SAAS,KAAX,EAAb,EAChBI,QADgB,CACP;AACRC,oBAAM,MADE;AAERC,sBAAQ;AAFA,aADO,EAKhBE,IALgB,CAKX,EAAC,aAAa,CAAC,CAAf,EALW,EAMhBP,IANgB,EADa;;AAAA;AAC1BQ,gBAD0B;;AAQhChB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMA;AAFG,aAAX;;AARgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAcA,IAAM3B;AAAA,8JAAa,kBAAMW,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAClBmB,cADkB,GACXpB,IAAIE,MADO,CAClBkB,EADkB;;AAAA,gBAEnBA,EAFmB;AAAA;AAAA;AAAA;;AAAA,8CAGdpB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAHG;;AAAA;AAAA;AAAA;AAAA,mBAUFtB,QAAQwB,OAAR,CAAgB,EAAEC,KAAKF,EAAP,EAAhB,EACjBT,QADiB,CACR;AACRC,oBAAM,MADE;AAERC,sBAAQ;AAFA,aADQ,EAKjBL,IALiB,EAVE;;AAAA;AAUlBjC,mBAVkB;AAAA;AAAA,mBAgBdsB,QAAQ0B,iBAAR,CAA0BH,EAA1B,EAA8B,EAACI,OAAOjD,QAAQiD,KAAR,GAAgB,CAAxB,EAA9B,EAA0DhB,IAA1D,EAhBc;;AAAA;AAiBtBR,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMzC;AAFG,aAAX;AAjBsB;AAAA;;AAAA;AAAA;AAAA;;AAsBtB;AACAyB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAvBsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAb;;AAAA;AAAA;AAAA;AAAA,GAAN;;AA8BA,IAAM1B;AAAA,8JAAc,kBAAMO,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AACrBgB,gBADqB,GACdjB,IAAIyB,OAAJ,CAAYR,IADE;AAAA,oBAESA,IAFT,EAEnBvE,KAFmB,SAEnBA,KAFmB,EAEZI,OAFY,SAEZA,OAFY,EAEHyD,OAFG,SAEHA,OAFG;;AAAA,kBAGrB,CAAC7D,KAAD,IAAU,CAACI,OAAX,IAAsB,CAAC4E,OAAOnB,OAAP,CAHF;AAAA;AAAA;AAAA;;AAAA,8CAIfP,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAJI;;AAAA;AAAA;AAAA;AAAA,mBAWV,IAAItB,OAAJ,CAAYoB,IAAZ,CAXU;;AAAA;AAWvBA,gBAXuB;AAAA;AAAA,mBAYjBA,KAAKU,IAAL,EAZiB;;AAAA;AAavB;AACA;AACA3B,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAfuB;AAAA;;AAAA;AAAA;AAAA;;AAoBvBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AApBuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAd;;AAAA;AAAA;AAAA;AAAA,GAAN;;AA2BP;AACO,IAAMxB;AAAA,8JAAe,kBAAMK,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AACtBgB,gBADsB,GACfjB,IAAIyB,OAAJ,CAAYR,IADG;;AAE1BA,iBAAKW,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AAF0B,qBAGYb,IAHZ,EAGpBG,EAHoB,UAGpBA,EAHoB,EAGhB1E,KAHgB,UAGhBA,KAHgB,EAGTI,OAHS,UAGTA,OAHS,EAGAyD,OAHA,UAGAA,OAHA;;AAAA,kBAItB,CAACa,EAAD,IAAO,CAAC1E,KAAR,IAAiB,CAACI,OAAlB,IAA6B,CAAC4E,OAAOnB,OAAP,CAJR;AAAA;AAAA;AAAA;;AAAA,8CAKhBP,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aALK;;AAAA;AAAA;AAAA;AAAA,mBAYXtB,QAAQ0B,iBAAR,CAA0BH,EAA1B,EAA8BH,IAA9B,EAAoCT,IAApC,EAZW;;AAAA;AAYxBS,gBAZwB;;AAaxBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAbwB;AAAA;;AAAA;AAAA;AAAA;;AAkBxBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAlBwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAyBA,IAAMvB;AAAA,8JAAgB,kBAAMI,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACrBmB,cADqB,GACdpB,IAAIE,MADU,CACrBkB,EADqB;;AAAA,gBAGtBA,EAHsB;AAAA;AAAA;AAAA;;AAAA,8CAIjBpB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAJM;;AAAA;AAAA;AAAA;AAAA,mBAWRtB,QAAQkC,iBAAR,CAA0BX,EAA1B,EAA8BZ,IAA9B,EAXQ;;AAAA;AAWrBS,gBAXqB;;AAYzBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAZyB;AAAA;;AAAA;AAAA;AAAA;;AAiBzBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAjByB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAhB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAwBA,IAAM/B;AAAA,8JAAS,kBAAMY,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACZ+B,mBADY,GACAhC,IAAIE,MADJ,CACZ8B,OADY;AAEdC,eAFc,GAER,IAAIC,MAAJ,CAAWF,OAAX,EAAoB,GAApB,CAFQ;AAAA;AAAA;AAAA,mBAIDnC,QAAQS,IAAR,CAAa;AAC5BC,uBAAS,IADmB;AAE5B4B,mBAAK,CAAC,EAAEzF,OAAO,EAAE0F,QAAQH,GAAV,EAAT,EAAD;AAFuB,aAAb,EAIhBlB,IAJgB,CAIX,EAAC,aAAa,CAAC,CAAf,EAJW,EAKhBP,IALgB,EAJC;;AAAA;AAIdS,gBAJc;;AAUlBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAVkB;AAAA;;AAAA;AAAA;AAAA;;AAelBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAfkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAT;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAsBA,IAAM3B;AAAA,8JAAW,kBAAMQ,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACDJ,QAAQS,IAAR,CAAa,EAAEC,SAAS,IAAX,EAAb,EAClBI,QADkB,CACT;AACRC,oBAAM,MADE;AAERC,sBAAQ;AAFA,aADS,EAKlBA,MALkB,CAKX,mCALW,EAMlBE,IANkB,CAMb,EAAC,aAAa,CAAC,CAAf,EANa,EAOlBP,IAPkB,EADC;;AAAA;AAClB6B,oBADkB;AASlBC,eATkB,GASZ,EATY,EAUpBC,IAVoB,GAUb,EAVa,EAWpBC,IAXoB,WAWdC,KAXc,WAWPC,IAXO;;AAYtB,iBAASC,CAAT,GAAa,CAAb,EAAgBA,IAAIN,SAAS3B,MAA7B,EAAqCiC,GAArC,EAA0C;AACxCH,qBAAO,IAAIX,IAAJ,CAASQ,SAASM,CAAT,EAAYC,SAArB,EAAgCC,WAAhC,KAAgD,EAAvD;AACAJ,sBAAQ,IAAIZ,IAAJ,CAASQ,SAASM,CAAT,EAAYC,SAArB,EAAgCE,QAAhC,KAA6C,CAA7C,GAAiD,EAAzD;AACA,kBAAIL,MAAM/B,MAAN,KAAiB,CAArB,EAAwB;AACtB+B,wBAAQ,MAAMA,KAAd;AACD;AACDC,qBAAUF,IAAV,cAAkBC,KAAlB;AACAH,kBAAIS,IAAJ,CAAS;AACPL,sBAAMA,IADC;AAEPnE,yBAAS8D,SAASM,CAAT;AAFF,eAAT;AAID;;AAED,iBAASA,EAAT,GAAa,CAAb,EAAgBA,KAAIL,IAAI5B,MAAxB,GAAiC;AAC3BD,mBAD2B,GACnB,CADmB,EAE7BuC,eAF6B,GAEX,EAFW;;AAG/B,mBAASC,CAAT,GAAaN,EAAb,EAAgBM,IAAIX,IAAI5B,MAAxB,EAAgCuC,GAAhC,EAAqC;AACnC,oBAAIX,IAAIK,EAAJ,EAAOD,IAAP,KAAgBJ,IAAIW,CAAJ,EAAOP,IAA3B,EAAiC;AAC/BM,kCAAgBD,IAAhB,CAAqBT,IAAIW,CAAJ,EAAO1E,OAA5B;AACAkC;AACD;AACF;AACD8B,mBAAKQ,IAAL,CAAU;AACRL,sBAAMJ,IAAIK,EAAJ,EAAOD,IADL;AAERL,0BAAUW,eAFF;AAGRvC,uBAAOA;AAHC,eAAV;AAKAkC,oBAAKlC,KAAL;AACD;;AAEDT,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMuB;AAFG,aAAX;;AA1CsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAgDA,IAAM7C;AAAA,8JAAS,kBAAMM,GAAN,EAAWC,IAAX;AAAA,cAIXiD,SAJW;AAAA;AAAA;AAAA;AAAA;AAIXA,qBAJW,YAIXA,SAJW,CAIDlD,GAJC,EAII;AACtB,qBAAO,IAAImD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCC,qBAAKC,KAAL,CAAWvD,IAAIwD,GAAf,EAAoB,UAASrC,GAAT,EAAcsC,MAAd,EAAsBC,KAAtB,EAA6B;AAC/C,sBAAIvC,GAAJ,EAAS;AACPwC,4BAAQC,GAAR,CAAYzC,GAAZ;AACAkC,2BAAOlC,GAAP;AACD;AACD;AACA,sBAAI0C,WAAWH,MAAMI,OAAOC,IAAP,CAAYL,KAAZ,EAAmBI,OAAOC,IAAP,CAAYL,KAAZ,EAAmBhD,MAAnB,GAA4B,CAA/C,CAAN,CAAf;;AAEA;AACA,sBAAIsD,UAAUnC,KAAKC,GAAL,KAAa,4CAAAlB,CAAKoD,OAAL,CAAaH,SAAShH,IAAtB,CAA3B;AACA,sBAAIoH,SAASJ,SAASjD,IAAtB;AACA,sBAAIsD,SAAS,cAAcF,OAA3B;;AAEA;AACA,sBAAIG,aAAa,0CAAAC,CAAGC,gBAAH,CAAoBJ,MAApB,CAAjB;AACA,sBAAIK,cAAc,0CAAAF,CAAGG,iBAAH,CAAqBL,MAArB,CAAlB;AACAC,6BAAWK,IAAX,CAAgBF,WAAhB;AACA,sBAAIG,SAASzE,IAAI0E,QAAJ,GAAe,KAAf,GAAuB1E,IAAIhE,IAA3B,GAAkC,UAAlC,GAA+CgI,OAA5D;AACAZ,0BAAQqB,MAAR;AACD,iBAnBD;AAoBD,eArBM,CAAP;AAsBD,aA3BmB;;AAEhBnB,gBAFgB,GAET,IAAI,kDAAAqB,CAAWC,YAAf,EAFS;AAAA;AAAA,mBA6Bd1B,UAAUlD,GAAV,EAAe6E,IAAf,CAAoB,UAACC,GAAD,EAAS;AACjC9E,kBAAIiB,IAAJ,GAAW6D,GAAX;AACD,aAFK,CA7Bc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAT;;AAAA;AAAA;AAAA;AAAA,GAAN,C;;;;;;;;;;;;;;;;;;;;;;ACrOP;AACA,IAAMC,MAAM,gDAAAjF,CAASC,KAAT,CAAe,KAAf,CAAZ;AACA,IAAMF,UAAU,gDAAAC,CAASC,KAAT,CAAe,SAAf,CAAhB;AACO,IAAMhB;AAAA,6JAAoB,iBAAMiB,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACzBmB,cADyB,GAClBpB,IAAIE,MADc,CACzBkB,EADyB,EACNJ,IADM;;AAAA,iBAE3BI,EAF2B;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAIdvB,QAAQS,IAAR,CAAa,EAAEC,SAAS,IAAX,EAAiByE,MAAM,CAAC5D,EAAD,CAAvB,EAAb,EACVT,QADU,CACD;AACRC,oBAAM,MADE;AAERC,sBAAQ;AAFA,aADC,EAKVE,IALU,CAKL,EAAE,aAAa,CAAC,CAAhB,EALK,EAMVP,IANU,EAJc;;AAAA;AAI3BQ,gBAJ2B;;AAW3BhB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMA;AAFG,aAAX;AAX2B;AAAA;;AAAA;AAAA;AAAA;;AAgB3BhB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAhB2B;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAsBhB4D,IAAIzE,IAAJ,CAAS,EAAT,EAAaS,IAAb,CAAkB,EAAE,aAAa,CAAC,CAAhB,EAAlB,EAAuCP,IAAvC,EAtBgB;;AAAA;AAsB7BQ,gBAtB6B;;AAuB7BhB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMA;AAFG,aAAX;;AAvB6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAApB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AA+BA,IAAMhC;AAAA,8JAAU,kBAAMgB,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AACjBgB,gBADiB,GACVjB,IAAIyB,OAAJ,CAAYR,IADF;AAAA,oBAENA,IAFM,EAEfpE,IAFe,SAEfA,IAFe;;AAAA,gBAIhBA,IAJgB;AAAA;AAAA;AAAA;;AAAA,8CAKXmD,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aALA;;AAAA;AAAA;;AAYnBF,mBAAO,IAAI8D,GAAJ,CAAQ9D,IAAR,CAAP;AAZmB;AAAA,mBAabA,KAAKU,IAAL,EAba;;AAAA;AAcnB3B,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAdmB;AAAA;;AAAA;AAAA;AAAA;;AAmBnBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAnBmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAV;;AAAA;AAAA;AAAA;AAAA,GAAN;;AA0BA,IAAMlC;AAAA,8JAAW,kBAAMe,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AAClBgB,gBADkB,GACXjB,IAAIyB,OAAJ,CAAYR,IADD;;AAEtBA,iBAAKW,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AAFsB,qBAGPb,IAHO,EAGdG,EAHc,UAGdA,EAHc;;AAAA,gBAIjBA,EAJiB;AAAA;AAAA;AAAA;;AAAA,8CAKZpB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aALC;;AAAA;AAAA;AAAA;AAAA,mBAYP4D,IAAIxD,iBAAJ,CAAsBH,EAAtB,EAA0BH,IAA1B,EAAgCT,IAAhC,EAZO;;AAAA;AAYpBS,gBAZoB;;AAapBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAboB;AAAA;;AAAA;AAAA;AAAA;;AAkBpBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAlBoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAyBA,IAAMhC;AAAA,8JAAY,kBAAMa,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBmB,cADiB,GACVpB,IAAIE,MADM,CACjBkB,EADiB;;AAAA,gBAGlBA,EAHkB;AAAA;AAAA;AAAA;;AAAA,8CAIbpB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAJE;;AAAA;AAAA;AAAA;AAAA,mBAWJ4D,IAAIhD,iBAAJ,CAAsBX,EAAtB,EAA0BZ,IAA1B,EAXI;;AAAA;AAWjBS,gBAXiB;;AAYrBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAZqB;AAAA;;AAAA;AAAA;AAAA;;AAiBrBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAjBqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAZ;;AAAA;AAAA;AAAA;AAAA,GAAN,C;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrFP;AACA;AACA;AACA;;AAEA,IAAM8D,OAAO,gDAAAnF,CAASC,KAAT,CAAe,MAAf,CAAb;;AAEO,IAAMlB;AAAA,6JAAQ,iBAAMmB,GAAN,EAAWC,IAAX;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gCACUD,IAAIyB,OAAJ,CAAYR,IADtB,EACb1F,QADa,qBACbA,QADa,EACHC,QADG,qBACHA,QADG;;AAEnBA,uBAAW,2CAAA0J,CAAI1J,QAAJ,CAAX;AAFmB;AAAA;AAAA,mBAIAyJ,KAAK5D,OAAL,CAAa,EAAC9F,UAAUA,QAAX,EAAqBC,UAAUA,QAA/B,EAAb,EAAuDgF,IAAvD,EAJA;;AAAA;AAIbnF,gBAJa;AAKbS,kBALa,GAKJ,wDAAAuC,CAAOxC,GAAP,CAAWC,MALP;AAMbqJ,qBANa,GAMD,wDAAA9G,CAAOxC,GAAP,CAAWsJ,SANV;AAObC,iBAPa,GAOL,oDAAAvJ,CAAIwJ,IAAJ,CAAS,EAAE9J,UAAUF,KAAKE,QAAjB,EAA2B+J,QAAQjK,KAAKiG,GAAxC,EAAT,EAAwDxF,MAAxD,CAPK;;AAQjBkE,gBAAIuF,OAAJ,CAAYC,GAAZ,CAAgB,OAAhB,EAAyBJ,KAAzB;AACApF,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAM;AACJoE,uBAAOA;AADH;AAFG,aAAX;AATiB;AAAA;;AAAA;AAAA;AAAA;;AAgBjBpF,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETF;AAFS,aAAX;;AAhBiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAR;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAuBA,IAAMlC;AAAA,8JAAS,kBAAMkB,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AACpBD,gBAAIuF,OAAJ,CAAYC,GAAZ,CAAgB,OAAhB,EAAyB,IAAzB;AACAxF,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAM;AAFG,aAAX;;AAFoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAT;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAQA,IAAMvC;AAAA,8JAAc,kBAAMuB,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACrBwF,qBADqB,GACTzF,IAAI0E,QAAJ,GAAe,KAAf,GAAuB1E,IAAIhE,IAA3B,GAAkC,UAAlC,GAA+C,wDAAAqC,CAAOhD,IAAP,CAAYO,MADlD;AAAA;AAAA;AAAA,mBAGNqJ,KAAK5D,OAAL,CAAa,EAAE/F,MAAM,YAAR,EAAb,EAAqCkF,IAArC,EAHM;;AAAA;AAGnBQ,gBAHmB;;AAIvBA,iBAAKpF,MAAL,GAAc6J,SAAd;AACAzF,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMA;AAFG,aAAX;AALuB;AAAA;;AAAA;AAAA;AAAA;;AAUvBhB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AAVuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAd;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAiBA,IAAMxC;AAAA,8JAAgB,kBAAMqB,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACvBgB,gBADuB,GAChBjB,IAAIyB,OAAJ,CAAYR,IADI;;AAAA,kBAGvBA,KAAKyE,WAAL,IAAoBzE,KAAK0E,WAHF;AAAA;AAAA;AAAA;;AAIzB;AACID,uBALqB,GAKP,2CAAAR,CAAIjE,KAAKyE,WAAT,CALO;AAMrBC,uBANqB,GAMP,2CAAAT,CAAIjE,KAAK0E,WAAT,CANO;AAAA;AAAA;AAAA,mBAQNV,KAAK5D,OAAL,CAAa,EAAE/F,MAAM,YAAR,EAAb,EAAqCkF,IAArC,EARM;;AAAA;AAQnBnF,gBARmB;;AAAA,kBASnBA,KAAKG,QAAL,KAAkBkK,WATC;AAAA;AAAA;AAAA;;AAAA,8CAUb1F,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAVE;;AAAA;AAAA;AAAA,mBAeV8D,KAAKW,gBAAL,CAAsB,EAAEtK,MAAM,YAAR,EAAtB,EAA8C,EAAEE,UAAUmK,WAAZ,EAAyB/D,WAAWC,KAAKC,GAAL,EAApC,EAA9C,EAAgGtB,IAAhG,EAfU;;AAAA;AAevBS,gBAfuB;;AAgBvBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AAhBuB;AAAA;;AAAA;AAAA;AAAA;;AAqBvBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AArBuB;AAAA;AAAA;;AAAA;AA2BzB;AACAF,iBAAKW,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AA5ByB;AAAA;AAAA,mBA8BVmD,KAAKW,gBAAL,CAAsB,EAAEtK,MAAM,YAAR,EAAtB,EAA8C2F,IAA9C,EAAoDT,IAApD,EA9BU;;AAAA;AA8BvBS,gBA9BuB;;AA+BvBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,IADA;AAETF,oBAAMC;AAFG,aAAX;AA/BuB;AAAA;;AAAA;AAAA;AAAA;;AAoCvBjB,gBAAIiB,IAAJ,GAAW;AACTC,uBAAS,KADA;AAETC;AAFS,aAAX;;AApCuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAhB;;AAAA;AAAA;AAAA;AAAA,GAAN,C;;;;;;;;;;;;;;;;;;;;ACvDP;AACA;AACA;AACA,IAAM8D,OAAO,gDAAAnF,CAASC,KAAT,CAAe,MAAf,CAAb;;4CAEA;AAAA,6JAAe,iBAAMC,GAAN,EAAWC,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACPmF,iBADO,GACCpF,IAAIxB,GAAJ,CAAQ,OAAR,CADD;;AAAA,iBAET4G,KAFS;AAAA;AAAA;AAAA;;AAGLS,mBAHK,GAGK,oDAAAhK,CAAIiK,MAAJ,CAAWV,KAAX,EAAkB,wDAAA/G,CAAOxC,GAAP,CAAWC,MAA7B,CAHL;AAILP,oBAJK,GAIMsK,QAAQtK,QAJd;AAKL+J,kBALK,GAKIO,QAAQP,MALZ;AAAA;AAAA;AAAA,mBAOQL,KAAK5D,OAAL,CAAa,EAAEC,KAAKgE,MAAP,EAAe/J,UAAUA,QAAzB,EAAb,EAAkDiF,IAAlD,EAPR;;AAAA;AAOLnF,gBAPK;;AAAA,kBAQLA,KAAKiG,GAAL,IAAYjG,KAAKE,QARZ;AAAA;AAAA;AAAA;;AAAA;AAAA,mBASD0E,MATC;;AAAA;AAAA;AAAA;;AAAA;AAAA,6CAWCD,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAXZ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,6CAiBDnB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC;AAFiB,aAjBV;;AAAA;AAAA;AAAA;;AAAA;AAAA,6CAuBHnB,IAAIiB,IAAJ,GAAW;AACjBC,uBAAS,KADQ;AAEjBC,mBAAK;AAFY,aAvBR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA,K;;;;;;;;;;ACLA;AACA,IAAM4E,SAAS,gDAAAjG,CAASiG,MAAxB;;AAEA,IAAMC,gBAAgB,IAAID,MAAJ,CAAW;AAC/BrJ,SAAOgF,MADwB;AAE/B5E,WAAS4E,MAFsB;AAG/BnB,WAAS;AACPrD,UAAM+I,OADC;AAEPC,aAAS;AAFF,GAHsB;AAO/B1E,SAAO;AACLtE,UAAMmD,MADD;AAEL6F,aAAS;AAFJ,GAPwB;AAW/BC,QAAM;AACJjJ,UAAMmD,MADF;AAEJ6F,aAAS;AAFL,GAXyB;AAe/BE,QAAM;AACJlJ,UAAMmJ,KADF;AAEJH,aAAS;AAFL,GAfyB;AAmB/BI,YAAU;AACRpJ,UAAMmJ,KADE;AAERH,aAAS;AAFD,GAnBqB;AAuB/BlB,QAAM,CAAC;AACL9H,UAAM6I,OAAOQ,KAAP,CAAaC,QADd;AAELC,SAAK;AAFA,GAAD,CAvByB;AA2B/B7D,aAAW;AACT1F,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL,GA3BoB;AA+B/BF,aAAW;AACT1E,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL;AA/BoB,CAAX,CAAtB;;AAqCAkE,cAAcU,OAAd,CAAsBC,MAAtB,GAA+B;AAC7BC,YAAU,IADmB;AAE7BC,cAAY,KAFiB;AAG7BC,WAH6B,qBAGnBC,GAHmB,EAGdC,GAHc,EAGT;AAClBA,QAAI5F,EAAJ,GAAS4F,IAAI1F,GAAb;AACA,WAAO0F,IAAI1F,GAAX;AACD;AAN4B,CAA/B;AAQA;AACA,gDAAAxB,CAASC,KAAT,CAAe,SAAf,EAA0BiG,aAA1B,E;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;;AAEA,mBAAAlI,CAAQ,EAAR;AACA,mBAAAA,CAAQ,EAAR;AACA,mBAAAA,CAAQ,EAAR;;AAEA,IAAMmH,OAAO,gDAAAnF,CAASC,KAAT,CAAe,MAAf,CAAb;;AAEA,IAAMkH,0BAAwB,wDAAA5I,CAAOtC,OAAP,CAAeC,IAAvC,SAA+C,wDAAAqC,CAAOtC,OAAP,CAAeG,IAA9D,SAAsE,wDAAAmC,CAAOtC,OAAP,CAAeE,QAA3F;AACA,gDAAA6D,CAASqD,OAAT,GAAmB+D,OAAO/D,OAA1B;AACA,gDAAArD,CAASqH,UAAT,CACGC,OADH,CACWH,QADX,EAEGI,IAFH,CAEQ,MAFR,kJAEgB;AAAA;AAAA;AAAA;AAAA;AAAA;AACZ1D,kBAAQC,GAAR,CAAY,4BAAZ;AACA;AACI0D,kBAHQ,GAGG,wDAAAjJ,CAAOhD,IAHV;;AAIZiM,mBAAS9L,QAAT,GAAoB,2CAAA0J,CAAIoC,SAAS9L,QAAb,CAApB;;AAJY;AAAA,iBAMKyJ,KAAK5D,OAAL,CAAa,EAAE/F,MAAM,YAAR,EAAb,EAAqCkF,IAArC,EANL;;AAAA;AAMRnF,cANQ;;AAAA,cAOPA,IAPO;AAAA;AAAA;AAAA;;AAQVA,iBAAO,IAAI4J,IAAJ,CAASqC,QAAT,CAAP;AARU;AAAA,iBASJjM,KAAKsG,IAAL,EATI;;AAAA;AAUVgC,kBAAQC,GAAR,CAAY,oDAAZ;;AAVU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAFhB,IAeG2D,EAfH,CAeM,OAfN,EAee,UAACC,KAAD,EAAW;AACtB7D,UAAQ8D,IAAR,CAAa,uBAAb,EAAsCD,KAAtC;AACD,CAjBH,E;;;;;;;;;;ACZA;AACA,IAAMzB,SAAS,gDAAAjG,CAASiG,MAAxB;;AAEA,IAAM2B,YAAY,IAAI3B,MAAJ,CAAW;AAC3BlJ,QAAM;AACJK,UAAMwE,MADF;AAEJwE,aAAS;AAFL,GADqB;AAK3BtD,aAAW;AACT1F,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL,GALgB;AAS3BF,aAAW;AACT1E,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL;AATgB,CAAX,CAAlB;;AAeA4F,UAAUhB,OAAV,CAAkBC,MAAlB,GAA2B;AACzBC,YAAU,IADe;AAEzBC,cAAY,KAFa;AAGzBC,WAHyB,qBAGfC,GAHe,EAGVC,GAHU,EAGL;AAClBA,QAAI5F,EAAJ,GAAS4F,IAAI1F,GAAb;AACA,WAAO0F,IAAI1F,GAAX;AACD;AANwB,CAA3B;;AASA,gDAAAxB,CAASC,KAAT,CAAe,KAAf,EAAsB2H,SAAtB,E;;;;;;;;;;AC3BA;AACA,IAAM3B,SAAS,gDAAAjG,CAASiG,MAAxB;;AAEA,IAAM4B,aAAa,IAAI5B,MAAJ,CAAW;AAC5BzK,QAAM;AACJ4B,UAAMwE,MADF;AAEJwE,aAAS;AAFL,GADsB;AAK5B3K,YAAUmG,MALkB;AAM5BlG,YAAUkG,MANkB;AAO5BjG,SAAOiG,MAPqB;AAQ5BhG,YAAUgG,MARkB;AAS5B/F,SAAO+F,MATqB;AAU5B9F,UAAQ8F,MAVoB;AAW5BkB,aAAW;AACT1F,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL,GAXiB;AAe5BF,aAAW;AACT1E,UAAM2E,IADG;AAETqE,aAASrE,KAAKC;AAFL;AAfiB,CAAX,CAAnB;;AAqBA;AACA6F,WAAWjB,OAAX,CAAmBC,MAAnB,GAA4B;AAC1BC,YAAU,IADgB;AAE1BC,cAAY,KAFc;AAG1BC,WAH0B,qBAGhBC,GAHgB,EAGXC,GAHW,EAGN;AAClBA,QAAI5F,EAAJ,GAAS4F,IAAI1F,GAAb;AACA,WAAO0F,IAAI1F,GAAX;AACA,WAAO0F,IAAI5F,EAAX;AACA,WAAO4F,IAAIxL,QAAX;AACA,WAAOwL,IAAIzL,QAAX;AACD;AATyB,CAA5B;AAWA,gDAAAuE,CAASC,KAAT,CAAe,MAAf,EAAuB4H,UAAvB,E;;;;;;ACpCA,uC;;;;;;ACAA,+B;;;;;;ACAA,+B;;;;;;ACAA,4C;;;;;;ACAA,2C;;;;;;ACAA,wC;;;;;;ACAA,gD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6JCWA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACQtL,eADR,GACc,IAAI,2CAAJ,EADd;AAEQL,gBAFR,GAEe4L,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,wDAAAC,CAAa1L,GAAb,CAAiBL,IAFpD;AAGQE,gBAHR,GAGe0L,QAAQC,GAAR,CAAYG,IAAZ,IAAoB,wDAAAD,CAAa1L,GAAb,CAAiBH,IAHpD;AAIQiC,kBAJR,GAIiB,IAAI,kDAAJ,EAJjB;;;AAME9B,gBAAI4L,GAAJ,CAAQ,iDAAAC,EAAR;AACA7L,gBAAI4L,GAAJ,CAAQ,sDAAAE,EAAR;AACA9L,gBAAI4L,GAAJ,CAAQ,kDAAAG,CAAU,GAAV,CAAR;AACAjK,mBAAO8J,GAAP,CAAW,EAAX,EAAe,wDAAAI,CAAMC,MAAN,EAAf;AACAjM,gBACC4L,GADD,CACK9J,OAAOmK,MAAP,EADL,EAECL,GAFD,CAEK9J,OAAOoK,cAAP,EAFL;;AAIA;AACIlK,kBAfN,GAee,mBAAAP,CAAQ,CAAR,CAff;;AAgBEO,mBAAOmK,GAAP,GAAa,EAAEnM,IAAIwL,GAAJ,KAAY,YAAd,CAAb;;AAEA;AACMY,gBAnBR,GAmBe,IAAI,0CAAJ,CAASpK,MAAT,CAnBf;;AAqBE;;AArBF,iBAsBMA,OAAOmK,GAtBb;AAAA;AAAA;AAAA;;AAuBUE,mBAvBV,GAuBoB,IAAI,6CAAJ,CAAYD,IAAZ,CAvBpB;AAAA;AAAA,mBAwBUC,QAAQ/K,KAAR,EAxBV;;AAAA;;AA2BEtB,gBAAI4L,GAAJ;AAAA,0KAAQ,iBAAOjI,GAAP,EAAYC,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACAA,MADA;;AAAA;AAEND,4BAAI2I,MAAJ,GAAa,GAAb,CAFM,CAEW;AAFX,yDAGC,IAAIxF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCrD,8BAAI4I,GAAJ,CAAQrB,EAAR,CAAW,OAAX,EAAoBnE,OAApB;AACApD,8BAAI4I,GAAJ,CAAQrB,EAAR,CAAW,QAAX,EAAqBnE,OAArB;AACAqF,+BAAKI,MAAL,CAAY7I,IAAIwD,GAAhB,EAAqBxD,IAAI4I,GAAzB,EAA8B,mBAAW;AACvC;AACAE,oCAAQjE,IAAR,CAAazB,OAAb,EAAsB2F,KAAtB,CAA4B1F,MAA5B;AACD,2BAHD;AAID,yBAPM,CAHD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAR;;AAAA;AAAA;AAAA;AAAA;;AAaAhH,gBAAI2M,MAAJ,CAAW9M,IAAX,EAAiBF,IAAjB;AACA2H,oBAAQC,GAAR,CAAY,yBAAyB5H,IAAzB,GAAgC,GAAhC,GAAsCE,IAAlD,EAzCF,CAyC0D;;AAzC1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAe+M,K;;;;;;;AAXf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA+CAA,Q","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ff9badca7560e896c749","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","export default {\r\n  user: {\r\n    role: 'superAdmin',\r\n    username: 'q',\r\n    password: 'q',\r\n    email: 'qq22337383@gmail.com',\r\n    nickname: 'VueBlog',\r\n    motto: 'Never too old to learn',\r\n    avatar: 'avatar.png'\r\n  },\r\n  jwt: {\r\n    secret: 'vueblog'\r\n  },\r\n  mongodb: {\r\n    host: '127.0.0.1',\r\n    database: 'vueblog',\r\n    port: 27017,\r\n    username: '',\r\n    password: ''\r\n  },\r\n  production: {\r\n    host: '198.13.32.165',\r\n    domain: 'https://www.86886.wang'\r\n    // domain: 'http://127.0.0.1:3000'\r\n  },\r\n  app: {\r\n    host: '127.0.0.1',\r\n    port: 3000,\r\n    routerBaseApi: '/api'\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"md5\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"md5\"\n// module id = 6\n// module chunks = 0","module.exports = {\r\n  head: {\r\n    title: 'VueBlog',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: '一个小而美的博客应用' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ]\r\n  },\r\n  css: ['~assets/css/main.css', 'highlight.js/styles/github.css','element-ui/lib/theme-chalk/index.css'],\r\n  loading: { color: '#337AB7' },\r\n  babel: {\r\n    plugins: [['component', [{\r\n      libraryName: 'element-ui',\r\n      styleLibraryName: 'theme-default'\r\n    }]]]\r\n  },\r\n  build: {\r\n    vendor: ['axios','element-ui'],\r\n    postcss: [\r\n      require('postcss-import')(),\r\n      require('postcss-url')(),\r\n      require('postcss-cssnext')()\r\n    ],\r\n    /*extend (config, ctx) {\r\n      if (ctx.isClient) {\r\n        config.module.rules.push({\r\n          enforce: 'pre',\r\n          test: /\\.(js|vue)$/,\r\n          loader: 'eslint-loader',\r\n          exclude: /(node_modules)(server)/\r\n        })\r\n      }\r\n    }*/\r\n  },\r\n  manifest: {\r\n    name: 'VueBlog',\r\n    description: 'A blog system',\r\n    theme_color: '#000'\r\n  },\r\n  modules: ['@nuxtjs/pwa'],\r\n  plugins: ['~/plugins/components.js', '~/plugins/filters.js','~/plugins/element-ui']\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import Router from 'koa-router'\r\nimport config from '../config'\r\nimport db from '../models'\r\nimport checkToken from '../middlewares/check-token'\r\n\r\nconst router = new Router({\r\n  prefix: config.app.routerBaseApi\r\n})\r\n\r\nconst user = require('../controllers/user')\r\nconst tag = require('../controllers/tag')\r\nconst article = require('../controllers/article')\r\n\r\nrouter\r\n  .get('/user', user.getUserInfo)\r\n  .patch('/user', user.patchUserInfo)\r\n  .post('/login', user.login)\r\n  .post('/logout', user.logout)\r\n\r\nrouter\r\n  .get('/tags/:id?', tag.getTagsOrArticles)\r\n  .post('/tag', checkToken, tag.postTag)\r\n  .patch('/tag', checkToken, tag.patchTag)\r\n  .del('/tag/:id?', checkToken, tag.deleteTag)\r\n\r\nrouter\r\n  .get('/search/:keyword?', article.search)\r\n  .get('/article/:id?', article.getArticle)\r\n  .get('/articles/:page?/:limit?', article.getArticles)\r\n  .get('/private-articles', checkToken, article.getPrivateArticles)\r\n  .get('/archives', article.archives)\r\n  .post('/article', checkToken, article.postArticle)\r\n  .post('/upload', checkToken, article.upload)\r\n  .patch('/article', checkToken, article.patchArticle)\r\n  .del('/article/:id?', checkToken, article.deleteArticle)\r\n\r\nexport default router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 13\n// module chunks = 0","import mongoose from 'mongoose'\r\nimport path from 'path'\r\nimport os from 'os'\r\nimport fs from 'fs'\r\nimport formidable from 'formidable'\r\nconst Article = mongoose.model('Article')\r\n\r\nexport const getArticles = async(ctx, next) => {\r\n  let { page = 1, limit = 15 } = ctx.params\r\n  page = Number((page - 1) * limit) || 0\r\n  limit = Number(limit) || 15\r\n\r\n  try {\r\n    let total = await Article.find({ publish: true }).exec()\r\n    total = total.length\r\n    const data = await Article.find({ publish: true })\r\n      .populate({\r\n        path: 'tags',\r\n        select: 'id name'\r\n      })\r\n      .skip(page)\r\n      .limit(limit)\r\n      .sort({'createdAt': -1})\r\n      .exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: data,\r\n      total: total\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e,\r\n      total: 0\r\n    }\r\n  }\r\n}\r\n\r\nexport const getPrivateArticles = async(ctx, next) => {\r\n  const data = await Article.find({ publish: false })\r\n    .populate({\r\n      path: 'tags',\r\n      select: 'id name'\r\n    })\r\n    .sort({'updatedAt': -1})\r\n    .exec()\r\n  ctx.body = {\r\n    success: true,\r\n    data: data\r\n  }\r\n}\r\n\r\nexport const getArticle = async(ctx, next) => {\r\n  let { id } = ctx.params\r\n  if (!id) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'id is required'\r\n    })\r\n  }\r\n\r\n  try {\r\n    let article = await Article.findOne({ _id: id })\r\n      .populate({\r\n        path: 'tags',\r\n        select: 'id name'\r\n      })\r\n      .exec()\r\n      await Article.findByIdAndUpdate(id, {views: article.views + 1}).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: article\r\n    }\r\n  } catch (e) {\r\n    // console.log(e)\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const postArticle = async(ctx, next) => {\r\n  let body = ctx.request.body\r\n  let { title, content, publish } = body\r\n  if (!title || !content || !String(publish)) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'Field incomplete'\r\n    })\r\n  }\r\n\r\n  try {\r\n    body = await new Article(body)\r\n    await body.save()\r\n    // when save article, we can replace id to object\r\n    // await body.populate('tags').execPopulate()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\n// modify publish article or private article\r\nexport const patchArticle = async(ctx, next) => {\r\n  let body = ctx.request.body\r\n  body.updatedAt = Date.now()\r\n  let { id, title, content, publish } = body\r\n  if (!id || !title || !content || !String(publish)) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'Field incomplete'\r\n    })\r\n  }\r\n\r\n  try {\r\n    body = await Article.findByIdAndUpdate(id, body).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const deleteArticle = async(ctx, next) => {\r\n  let { id } = ctx.params\r\n\r\n  if (!id) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'id is required'\r\n    })\r\n  }\r\n\r\n  try {\r\n    let body = await Article.findByIdAndRemove(id).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const search = async(ctx, next) => {\r\n  const { keyword } = ctx.params\r\n  const reg = new RegExp(keyword, 'i');\r\n  try {\r\n    let body = await Article.find({\r\n      publish: true,\r\n      $or: [{ title: { $regex: reg } }]\r\n    })\r\n    .sort({'createdAt': -1})\r\n    .exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const archives = async(ctx, next) => {\r\n  let articles = await Article.find({ publish: true })\r\n    .populate({\r\n      path: 'tags',\r\n      select: 'id name'\r\n    })\r\n    .select('id title tags createdAt updatedAt')\r\n    .sort({'createdAt': -1})\r\n    .exec()\r\n  let arr = [],\r\n    arr2 = [],\r\n    year, month, date\r\n  for (let i = 0; i < articles.length; i++) {\r\n    year = new Date(articles[i].createdAt).getFullYear() + ''\r\n    month = new Date(articles[i].createdAt).getMonth() + 1 + ''\r\n    if (month.length === 1) {\r\n      month = '0' + month;\r\n    }\r\n    date = `${year}年${month}月`\r\n    arr.push({\r\n      date: date,\r\n      article: articles[i]\r\n    })\r\n  }\r\n\r\n  for (let i = 0; i < arr.length;) {\r\n    let total = 0,\r\n      archiveArticles = [];\r\n    for (let j = i; j < arr.length; j++) {\r\n      if (arr[i].date === arr[j].date) {\r\n        archiveArticles.push(arr[j].article)\r\n        total++\r\n      }\r\n    }\r\n    arr2.push({\r\n      date: arr[i].date,\r\n      articles: archiveArticles,\r\n      total: total\r\n    })\r\n    i += total\r\n  }\r\n\r\n  ctx.body = {\r\n    success: true,\r\n    data: arr2\r\n  }\r\n}\r\n\r\nexport const upload = async(ctx, next) => {\r\n\r\n  let form = new formidable.IncomingForm()\r\n\r\n  function getImgUrl(ctx) {\r\n    return new Promise((resolve, reject) => {\r\n      form.parse(ctx.req, function(err, fields, files) {\r\n        if (err) {\r\n          console.log(err)\r\n          reject(err)\r\n        }\r\n        // console.log(files)\r\n        let lastItem = files[Object.keys(files)[Object.keys(files).length - 1]]\r\n\r\n        // fetch file extname\r\n        let extname = Date.now() + path.extname(lastItem.name)\r\n        let oldUrl = lastItem.path\r\n        let newUrl = './public/' + extname\r\n\r\n        // modify file name and upload file\r\n        let readStream = fs.createReadStream(oldUrl)\r\n        let writeStream = fs.createWriteStream(newUrl)\r\n        readStream.pipe(writeStream)\r\n        let imgUrl = ctx.protocol + '://' + ctx.host + '/public/' + extname\r\n        resolve(imgUrl)\r\n      })\r\n    })\r\n  }\r\n\r\n  await getImgUrl(ctx).then((url) => {\r\n    ctx.body = url\r\n  })\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/article.js","import mongoose from 'mongoose'\r\nconst Tag = mongoose.model('Tag')\r\nconst Article = mongoose.model('Article')\r\nexport const getTagsOrArticles = async(ctx, next) => {\r\n  let { id } = ctx.params, data\r\n  if (id) {\r\n    try {\r\n      data = await Article.find({ publish: true, tags: [id] })\r\n        .populate({\r\n          path: 'tags',\r\n          select: 'id name'\r\n        })\r\n        .sort({ 'updatedAt': -1 })\r\n        .exec()\r\n      ctx.body = {\r\n        success: true,\r\n        data: data\r\n      }\r\n    } catch (e) {\r\n      ctx.body = {\r\n        success: false,\r\n        err: e\r\n      }\r\n    }\r\n  } else {\r\n    data = await Tag.find({}).sort({ 'updatedAt': -1 }).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: data\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport const postTag = async(ctx, next) => {\r\n  let body = ctx.request.body\r\n  let { name } = body\r\n\r\n  if (!name) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'Tag name is required'\r\n    })\r\n  }\r\n\r\n  try {\r\n    body = new Tag(body)\r\n    await body.save()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const patchTag = async(ctx, next) => {\r\n  let body = ctx.request.body\r\n  body.updatedAt = Date.now()\r\n  const { id } = body\r\n  if (!id) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'id is required'\r\n    })\r\n  }\r\n\r\n  try {\r\n    body = await Tag.findByIdAndUpdate(id, body).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const deleteTag = async(ctx, next) => {\r\n  let { id } = ctx.params\r\n\r\n  if (!id) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'id is required'\r\n    })\r\n  }\r\n\r\n  try {\r\n    let body = await Tag.findByIdAndRemove(id).exec()\r\n    ctx.body = {\r\n      success: true,\r\n      data: body\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/tag.js","import mongoose from 'mongoose'\r\nimport jwt from 'jsonwebtoken'\r\nimport md5 from 'md5'\r\nimport config from '../config'\r\n\r\nconst User = mongoose.model('User')\r\n\r\nexport const login = async(ctx, next) => {\r\n  let { username, password } = ctx.request.body\r\n  password = md5(password)\r\n  try {\r\n    let user = await User.findOne({username: username, password: password}).exec()\r\n    let secret = config.jwt.secret\r\n    let expiresIn = config.jwt.expiresIn\r\n    let token = jwt.sign({ username: user.username, userID: user._id }, secret)\r\n    ctx.cookies.set('token', token)\r\n    ctx.body = {\r\n      success: true,\r\n      data: {\r\n        token: token\r\n      }\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      data: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const logout = async(ctx, next) => {\r\n  ctx.cookies.set('token', null)\r\n  ctx.body = {\r\n    success: true,\r\n    data: {}\r\n  }\r\n}\r\n\r\nexport const getUserInfo = async(ctx, next) => {\r\n  let avatarUrl = ctx.protocol + '://' + ctx.host + '/public/' + config.user.avatar\r\n  try {\r\n    let data = await User.findOne({ role: 'superAdmin' }).exec()\r\n    data.avatar = avatarUrl\r\n    ctx.body = {\r\n      success: true,\r\n      data: data\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\n\r\nexport const patchUserInfo = async(ctx, next) => {\r\n  let body = ctx.request.body\r\n\r\n  if (body.oldPassword && body.newPassword) {\r\n    // update password\r\n    let oldPassword = md5(body.oldPassword)\r\n    let newPassword = md5(body.newPassword)\r\n    try {\r\n      let user = await User.findOne({ role: 'superAdmin' }).exec()\r\n      if (user.password !== oldPassword) {\r\n        return (ctx.body = {\r\n          success: false,\r\n          err: 'Wrong password'\r\n        })\r\n      }\r\n      body = await User.findOneAndUpdate({ role: 'superAdmin' }, { password: newPassword, updatedAt: Date.now() }).exec()\r\n      ctx.body = {\r\n        success: true,\r\n        data: body\r\n      }\r\n    } catch (e) {\r\n      ctx.body = {\r\n        success: false,\r\n        err: e\r\n      }\r\n    }\r\n  } else {\r\n    // update info\r\n    body.updatedAt = Date.now()\r\n    try {\r\n      body = await User.findOneAndUpdate({ role: 'superAdmin' }, body).exec()\r\n      ctx.body = {\r\n        success: true,\r\n        data: body\r\n      }\r\n    } catch (e) {\r\n      ctx.body = {\r\n        success: false,\r\n        err: e\r\n      }\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import mongoose from 'mongoose'\r\nimport jwt from 'jsonwebtoken'\r\nimport config from '../config'\r\nconst User = mongoose.model('User')\r\n\r\nexport default async(ctx, next) => {\r\n  const token = ctx.get('token')\r\n  if (token) {\r\n    const decoded = jwt.verify(token, config.jwt.secret)\r\n    const username = decoded.username\r\n    const userID = decoded.userID\r\n    try {\r\n      let user = await User.findOne({ _id: userID, username: username }).exec()\r\n      if (user._id && user.username) {\r\n        await next()\r\n      } else {\r\n        return (ctx.body = {\r\n          success: false,\r\n          err: 'Token is invalid'\r\n        })\r\n      }\r\n    } catch (e) {\r\n      return (ctx.body = {\r\n        success: false,\r\n        err: e\r\n      })\r\n    }\r\n  } else {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: 'Please login'\r\n    })\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/check-token.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\n\r\nconst ArticleSchema = new Schema({\r\n  title: String,\r\n  content: String,\r\n  publish: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  views: {\r\n    type: Number,\r\n    default: 0\r\n  },\r\n  flag: {\r\n    type: Number,\r\n    default: 1\r\n  },\r\n  like: {\r\n    type: Array,\r\n    default: []\r\n  },\r\n  comments: {\r\n    type: Array,\r\n    default: []\r\n  },\r\n  tags: [{\r\n    type: Schema.Types.ObjectId,\r\n    ref: 'Tag'\r\n  }],\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n})\r\n\r\nArticleSchema.options.toJSON = {\r\n  virtuals: true,\r\n  versionKey: false,\r\n  transform(doc, ret) {\r\n    ret.id = ret._id\r\n    delete ret._id\r\n  }\r\n}\r\n// db.articles.update({}, {$set: {flag: 1}}, {multi: 1})\r\nmongoose.model('Article', ArticleSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/article.js","import mongoose from 'mongoose'\r\nimport md5 from 'md5'\r\nimport config from '../config'\r\n\r\nrequire('./user')\r\nrequire('./tag')\r\nrequire('./article')\r\n\r\nconst User = mongoose.model('User')\r\n\r\nconst mongoUrl = `mongodb://${config.mongodb.host}:${config.mongodb.port}/${config.mongodb.database}`\r\nmongoose.Promise = global.Promise\r\nmongoose.connection\r\n  .openUri(mongoUrl)\r\n  .once('open', async () => {\r\n    console.log('database connect successed')\r\n    // init admin information\r\n    let userInfo = config.user\r\n    userInfo.password = md5(userInfo.password)\r\n\r\n    let user = await User.findOne({ role: 'superAdmin' }).exec()\r\n    if (!user) {\r\n      user = new User(userInfo)\r\n      await user.save()\r\n      console.log('Administrator information initialization succeeded')\r\n    }\r\n  })\r\n  .on('error', (error) => {\r\n    console.warn('database connect fail', error)\r\n  })\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\n\r\nconst TagSchema = new Schema({\r\n  name: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n})\r\n\r\nTagSchema.options.toJSON = {\r\n  virtuals: true,\r\n  versionKey: false,\r\n  transform(doc, ret) {\r\n    ret.id = ret._id\r\n    delete ret._id\r\n  }\r\n}\r\n\r\nmongoose.model('Tag', TagSchema);\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/tag.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\n\r\nconst UserSchema = new Schema({\r\n  role: {\r\n    type: String,\r\n    default: 'user',\r\n  },\r\n  username: String,\r\n  password: String,\r\n  email: String,\r\n  nickname: String,\r\n  motto: String,\r\n  avatar: String,\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n})\r\n\r\n// hidden some field\r\nUserSchema.options.toJSON = {\r\n  virtuals: true,\r\n  versionKey: false,\r\n  transform(doc, ret) {\r\n    ret.id = ret._id\r\n    delete ret._id\r\n    delete ret.id\r\n    delete ret.password\r\n    delete ret.username\r\n  }\r\n}\r\nmongoose.model('User', UserSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = require(\"formidable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"formidable\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"postcss-cssnext\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"postcss-cssnext\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"postcss-import\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"postcss-import\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"postcss-url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"postcss-url\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 28\n// module chunks = 0","import Koa from 'koa'\r\nimport { Nuxt, Builder } from 'nuxt'\r\nimport path from 'path'\r\nimport KoaStatic from 'koa-static'\r\nimport bodyParser from 'koa-bodyparser'\r\nimport Router from 'koa-router'\r\nimport cors from '@koa/cors'\r\nimport globalConfig from './config'\r\nimport route from './routes'\r\n\r\n\r\nasync function start () {\r\n  const app = new Koa()\r\n  const host = process.env.HOST || globalConfig.app.host\r\n  const port = process.env.PORT || globalConfig.app.port\r\n  const router = new Router()\r\n\r\n  app.use(cors())\r\n  app.use(bodyParser())\r\n  app.use(KoaStatic('.'))\r\n  router.use('', route.routes())\r\n  app\r\n  .use(router.routes())\r\n  .use(router.allowedMethods())\r\n\r\n  // Import and Set Nuxt.js options\r\n  let config = require('../nuxt.config.js')\r\n  config.dev = !(app.env === 'production')\r\n\r\n  // Instantiate nuxt.js\r\n  const nuxt = new Nuxt(config)\r\n\r\n  // Build in development\r\n  if (config.dev) {\r\n    const builder = new Builder(nuxt)\r\n    await builder.build()\r\n  }\r\n\r\n  app.use(async (ctx, next) => {\r\n    await next()\r\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\r\n    return new Promise((resolve, reject) => {\r\n      ctx.res.on('close', resolve)\r\n      ctx.res.on('finish', resolve)\r\n      nuxt.render(ctx.req, ctx.res, promise => {\r\n        // nuxt.render passes a rejected promise into callback on error.\r\n        promise.then(resolve).catch(reject)\r\n      })\r\n    })\r\n  })\r\n\r\n  app.listen(port, host)\r\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\r\n}\r\n\r\nstart()\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}